"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var asyncScheduler_1 = require("rxjs/internal/scheduler/asyncScheduler");
var Subscription_1 = require("rxjs/internal/Subscription");
var toAnimate = [];
var animId = 0;
exports.animationFrameScheduler = {
    now: function () {
        return Date.now();
    },
    schedule: function (work, delay, state, subs) {
        if (delay === void 0) { delay = 0; }
        if (state === void 0) { state = undefined; }
        subs = subs || new Subscription_1.Subscription();
        if (delay > 0) {
            asyncScheduler_1.asyncScheduler.schedule(function (state) {
                exports.animationFrameScheduler.schedule(work, 0, state, subs);
            }, delay, state, subs);
        }
        else {
            toAnimate.push(work, state);
            subs.add(function () {
                var i = toAnimate.indexOf(work);
                if (i >= 0) {
                    toAnimate.splice(i, 2);
                    if (toAnimate.length === 0) {
                        cancelAnimationFrame(animId);
                    }
                }
            });
            if (toAnimate.length === 2) {
                animId = requestAnimationFrame(function () {
                    while (toAnimate.length > 0) {
                        toAnimate.shift()(toAnimate.shift());
                    }
                });
            }
        }
        return subs;
    }
};
//# sourceMappingURL=animationFrameScheduler.js.map