"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var userFunction_1 = require("rxjs/internal/util/userFunction");
var from_1 = require("rxjs/internal/create/from");
var MutableSubscriber_1 = require("rxjs/internal/MutableSubscriber");
function switchMap(project) {
    return function (source) { return source.lift(switchMapOperator(project)); };
}
exports.switchMap = switchMap;
function switchMapOperator(project) {
    return function switchMapLifted(source) {
        var mut = this;
        var _next = mut.next;
        var _complete = mut.complete;
        var index = 0;
        var _innerSub;
        var _outerCompleted = false;
        mut.next = function (value) {
            var result = userFunction_1.tryUserFunction(function () { return from_1.from(project(value, index++)); });
            if (userFunction_1.resultIsError(result)) {
                mut.error(result.error);
            }
            else {
                if (_innerSub) {
                    _innerSub.unsubscribe();
                    _innerSub = null;
                }
                var innerMut = new MutableSubscriber_1.MutableObserverSubscriber({
                    next: _next,
                    error: mut.error,
                    complete: function () {
                        _innerSub = null;
                        if (_outerCompleted) {
                            _complete();
                        }
                    }
                });
                mut.subscription.add(_innerSub = result.subscribe(innerMut));
            }
        };
        mut.complete = function () {
            _outerCompleted = true;
            if (!_innerSub) {
                _complete();
            }
        };
        return source.subscribe(mut);
    };
}
//# sourceMappingURL=switchMap.js.map