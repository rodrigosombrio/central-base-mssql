"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var userFunction_1 = require("rxjs/internal/util/userFunction");
function scan(reducer, initialState) {
    var hasState = arguments.length >= 2;
    return function (source) { return source.lift(scanOperator(reducer, initialState, hasState)); };
}
exports.scan = scan;
function scanOperator(reducer, initialState, hasState) {
    return function scanLifted(source) {
        var mut = this;
        var _next = mut.next;
        var _state = initialState;
        var _index = 0;
        mut.next = function (value) {
            if (hasState) {
                value = userFunction_1.tryUserFunction(reducer, [_state, value, _index++]);
                if (userFunction_1.resultIsError(value)) {
                    mut.error(value.error);
                    return;
                }
            }
            _state = value;
            hasState = true;
            _next(value);
        };
        return source.subscribe(this);
    };
}
//# sourceMappingURL=scan.js.map